

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Timer API &mdash; M5Stack 1.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Neopixel API" href="neopixel.html" />
    <link rel="prev" title="DAC API" href="dac.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> M5Stack
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../product-documents/index.html">Product Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../lcd/lcd.html">LCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../button/button.html">Button</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Peripherals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="uart.html">UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc.html">ADC</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html">DAC</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Timer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="neopixel.html">Neopixel</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html">I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi.html">SPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="rtc.html">RTC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../speaker/speaker.html">Speaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sd_card/sd_card.html">SD Card</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic-cases/index.html">M5Stack Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m5stack-awesome/index.html">M5Stack Awesome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m5stack-faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">M5Stack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="index.html">Peripherals API</a> &raquo;</li>
        
      <li>Timer API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api-reference/peripherals/timer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="timer-api">
<h1>Timer API<a class="headerlink" href="#timer-api" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The ESP32 chip contains two hardware timer groups. Each group has two general-purpose hardware timers. They are all 64-bit generic timers based on 16-bit prescalers and 64-bit auto-reload-capable up / down counters.</p>
<p><em>Note: Due to MicroPython callback latency, some callbacks may not be executed if the timer period is less than 15 ms.
The number of events and executed callbacks can be checked using tm.events() method.</em></p>
</div>
<hr class="docutils" />
<div class="section" id="function">
<h2>Function<a class="headerlink" href="#function" title="Permalink to this headline">¶</a></h2>
<div class="section" id="machine-timer-timer-no">
<h3>machine.Timer(timer_no)<a class="headerlink" href="#machine-timer-timer-no" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
<div class="line-block">
<div class="line">Create the Timer instance object</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Parament:</strong></div>
<div class="line-block">
<div class="line"><strong>timer_no:</strong> the timer number to be used for the timer</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="init-period-mode-callback-dbgpin">
<h3>init(period, mode, callback, dbgpin)<a class="headerlink" href="#init-period-mode-callback-dbgpin" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
<div class="line-block">
<div class="line">initialize paraments of the timer</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Parament:</strong></div>
<div class="line-block">
<div class="line"><strong>period:</strong>   Timer period(Default: 10 ms)</div>
<div class="line-block">
<div class="line"><em>Note: Timer period in ms, only used for PERIODIC and ONE_SHOT timers</em></div>
</div>
<div class="line"><strong>mode:</strong>     Timer mode of operation(Default: PERIODIC)</div>
<div class="line"><strong>callback:</strong> The Python callback function to be executed on timer event(Default: None)</div>
<div class="line"><strong>dbgpin:</strong>   GPIO pin to be used as debug output(Default: -1 (not used))</div>
<div class="line-block">
<div class="line"><em>Note: If used, the gpio level will toggle on each timer event</em></div>
</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Return:</strong></div>
<div class="line-block">
<div class="line">None</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="k">import</span> <span class="n">SPI</span><span class="p">,</span> <span class="n">Pin</span>

<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span>
    <span class="n">spihost</span><span class="o">=</span><span class="n">SPI</span><span class="o">.</span><span class="n">HSPI</span><span class="p">,</span>
    <span class="n">baudrate</span><span class="o">=</span><span class="mi">2600000</span>
    <span class="n">sck</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span>
    <span class="n">mosi</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">23</span><span class="p">),</span>
    <span class="n">miso</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">spi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1">#NOHEAP</span>
</pre></div>
</div>
</div>
<div class="section" id="value">
<h3>value()<a class="headerlink" href="#value" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
</div>
<div class="line-block">
<div class="line"><strong>Return:</strong></div>
<div class="line-block">
<div class="line">Returns the current timer counter value in <strong>µs</strong> if timer mode is CHRONO or in <strong>ms</strong> for other modes</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>

<span class="n">tcounter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tcb</span><span class="p">(</span><span class="n">timer</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">tcounter</span>
    <span class="k">if</span> <span class="n">tcounter</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tcounter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tcounter</span> <span class="o">%</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[tcb] timer: </span><span class="si">{}</span><span class="s2"> counter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="o">.</span><span class="n">timernum</span><span class="p">(),</span> <span class="n">tcounter</span><span class="p">))</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t1</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">t1</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">tcb</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="neopixel.html" class="btn btn-neutral float-right" title="Neopixel API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dac.html" class="btn btn-neutral" title="DAC API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 - 2018, M5Stack Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.1',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>