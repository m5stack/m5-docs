

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SPI API &mdash; M5Stack 1.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RTC API" href="rtc.html" />
    <link rel="prev" title="I2C API" href="i2c.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> M5Stack
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../product-documents/index.html">Product Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../lcd/lcd.html">LCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../button/button.html">Button</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Peripherals</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="uart.html">UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc.html">ADC</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html">DAC</a></li>
<li class="toctree-l3"><a class="reference internal" href="timer.html">Timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="neopixel.html">Neopixel</a></li>
<li class="toctree-l3"><a class="reference internal" href="i2c.html">I2C</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SPI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rtc.html">RTC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../speaker/speaker.html">Speaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sd_card/sd_card.html">SD Card</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic-cases/index.html">M5Stack Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m5stack-awesome/index.html">M5Stack Awesome</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../m5stack-faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">M5Stack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Reference</a> &raquo;</li>
        
          <li><a href="index.html">Peripherals API</a> &raquo;</li>
        
      <li>SPI API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api-reference/peripherals/spi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spi-api">
<h1>SPI API<a class="headerlink" href="#spi-api" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This class includes full support for using ESP32 SPI peripheral in master mode</p>
<p>Only SPI master mode is supported for now.</p>
<p>Python exception wil be raised if the requested spihost is used by SD Card driver (sdcard in spi mode).
If the requested spihost is VSPI and the psRAM is used at 80 MHz, the exception will be raised.
The exception will be raised if SPI cannot be configured for given configurations.</p>
</div>
<hr class="docutils" />
<div class="section" id="function">
<h2>Function<a class="headerlink" href="#function" title="Permalink to this headline">¶</a></h2>
<div class="section" id="machine-spi-spihost-baudrate-polarity-phase-firstbit-sck-mosi-miso-cs-duplex-bits">
<h3>machine.spi(spihost, baudrate, polarity, phase, firstbit, sck, mosi, miso, cs, duplex, bits)<a class="headerlink" href="#machine-spi-spihost-baudrate-polarity-phase-firstbit-sck-mosi-miso-cs-duplex-bits" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
<div class="line-block">
<div class="line">Create the spi instance object</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Parament:</strong></div>
<div class="line-block">
<div class="line"><strong>spihost:</strong> The hardware SPI host. machine-SPI.HSPI (1) or machine.SPI.VSPI (2) can be used. Default: 1</div>
<div class="line"><strong>baudrate:</strong> SPI clock speed in Hz; Default: 1000000</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="k">import</span> <span class="n">SPI</span><span class="p">,</span> <span class="n">Pin</span>

<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span>
    <span class="n">spihost</span><span class="o">=</span><span class="n">SPI</span><span class="o">.</span><span class="n">HSPI</span><span class="p">,</span>
    <span class="n">baudrate</span><span class="o">=</span><span class="mi">2600000</span>
    <span class="n">sck</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span>
    <span class="n">mosi</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">23</span><span class="p">),</span>
    <span class="n">miso</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-buf">
<h3>write(buf)<a class="headerlink" href="#write-buf" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
<div class="line-block">
<div class="line">Write bytes from buffer object buf to the SPI device</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Parament:</strong></div>
<div class="line-block">
<div class="line"><strong>buf:</strong> data buffer to be write</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Return:</strong></div>
<div class="line-block">
<div class="line">Returns <cite>True</cite> on success, <cite>False</cite> ion error</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="k">import</span> <span class="n">SPI</span><span class="p">,</span> <span class="n">Pin</span>

<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span>
    <span class="n">spihost</span><span class="o">=</span><span class="n">SPI</span><span class="o">.</span><span class="n">HSPI</span><span class="p">,</span>
    <span class="n">baudrate</span><span class="o">=</span><span class="mi">2600000</span>
    <span class="n">sck</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span>
    <span class="n">mosi</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">23</span><span class="p">),</span>
    <span class="n">miso</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">spi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1">#NOHEAP</span>
</pre></div>
</div>
</div>
<div class="section" id="write-readinto-wr-buf-rd-buf">
<h3>write_readinto(wr_buf, rd_buf)<a class="headerlink" href="#write-readinto-wr-buf-rd-buf" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><strong>Description:</strong></div>
<div class="line-block">
<div class="line">Write bytes from buffer object wr_buf to the SPI device and reads from SPI device into buffer object rd_buf</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Parament:</strong></div>
<div class="line-block">
<div class="line"><strong>wr_buf:</strong> data buffer to be write</div>
<div class="line"><strong>rd_buf:</strong> data buffer to be read</div>
<div class="line"><a href="#id1"><span class="problematic" id="id2">*</span></a>Note: * In fullduplex mode write and read are simultaneous. In halfduplex mode the data are first written to the device, then read from it</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Return:</strong></div>
<div class="line-block">
<div class="line">Returns <cite>True</cite> on success, <cite>False</cite> ion error</div>
</div>
</div>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">machine</span>

<span class="n">adc</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
<span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="k">import</span> <span class="n">SPI</span><span class="p">,</span> <span class="n">Pin</span>

<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span>
    <span class="n">spihost</span><span class="o">=</span><span class="n">SPI</span><span class="o">.</span><span class="n">HSPI</span><span class="p">,</span>
    <span class="n">baudrate</span><span class="o">=</span><span class="mi">2600000</span>
    <span class="n">sck</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span>
    <span class="n">mosi</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">23</span><span class="p">),</span>
    <span class="n">miso</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">19</span><span class="p">),</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">spi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1">#NOHEAP</span>
<span class="n">spi</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span> <span class="c1">#write is the byte to ?output on MOSI for each byte read in</span>
<span class="n">spi</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span> <span class="c1">#NOHEAP</span>
<span class="n">spi</span><span class="o">.</span><span class="n">write_readinto</span><span class="p">(</span><span class="n">write_buf</span><span class="p">,</span> <span class="n">read_buf</span><span class="p">)</span> <span class="c1">#NOHEAP; write_buf and read_buf can be the same</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rtc.html" class="btn btn-neutral float-right" title="RTC API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="i2c.html" class="btn btn-neutral" title="I2C API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 - 2018, M5Stack Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.1',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>