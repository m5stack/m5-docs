# USB ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« {docsify-ignore-all}

<img src="assets/img/product_pics/module/module_usb_01.png" width="30%" height="30%"> <img src="assets/img/product_pics/module/module_usb_02.png" width="30%" height="30%">

***

:memo:**[æ¦‚è¦](#æ¦‚è¦)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:octocat:**[ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](#ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:electric_plug:**[å›è·¯å›³](#å›è·¯å›³)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ›’**[è³¼å…¥ãƒªãƒ³ã‚¯](https://www.aliexpress.com/item/M5Stack-New-USB-Module-USB-HOST-HID-with-MAX3421E-SPI-Interface-Output-5-Input-5-Compatible/32961627365.html)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:clapper:**[é–¢é€£å‹•ç”»](#é–¢é€£å‹•ç”»)**

## æ¦‚è¦

<mark>**USB**</mark>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯**MAX3421E**ã‚’å†…è”µã—ãŸUSBã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã™ã€‚ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯M5Coreã¨æœ€å¤§é€šä¿¡é€Ÿåº¦26MHzã®SPIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æ¥ç¶šã•ã‚Œã€USBãƒ›ã‚¹ãƒˆã‚„USBãƒšãƒªãƒ•ã‚§ãƒ©ãƒ«ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚

## ç‰¹å¾´

- æœ€å¤§é€šä¿¡é€Ÿåº¦26MHz SPIã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- 8-way GPIOå…¥å‡ºåŠ›
- å†…è”µãƒªãƒã‚¦ãƒ é›»æ± ã‚³ãƒã‚¯ã‚¿

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å®¹

- 1x USBãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

- USBã‚­ãƒ¼ãƒ­ã‚¬ãƒ¼
- USBãƒ¡ãƒ¢ãƒªã®ãƒªãƒ¼ãƒ‰ãƒ©ã‚¤ãƒˆ

## é–¢é€£ãƒªãƒ³ã‚¯

- **[å…¬å¼ãƒ“ãƒ‡ã‚ª](https://www.youtube.com/channel/UCozgFVglWYQXbvTmGyS739w)**

- **[ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ](http://forum.m5stack.com/)**

- **ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ**
 - [MAX3421E](https://www.sparkfun.com/datasheets/DevTools/Arduino/MAX3421E.pdf)

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

*å®Œå…¨ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/USB/Arduino)ã€‚*

**NOTE:** ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€å¯¾å¿œUSBãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’[ã“ã¡ã‚‰](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/USB/Arduino/Library)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚æ¬¡ã«Arduino IDE ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ `ã‚¹ã‚±ãƒƒãƒ` â†’ `ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰` â†’ `.ZIPå½¢å¼ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«...`ã‚’é¸æŠå¾Œã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã€å–ã‚Šè¾¼ã¿ã¾ã™ã€‚

<img src="assets/img/product_pics/module/module_usb_03.png">

<img src="assets/img/product_pics/module/module_usb_04.png">

`usb_mouse.ino`ã‚’M5Coreã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚USBãƒã‚¦ã‚¹ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æ¥ç¶šã—ã¾ã™ã€‚ãƒã‚¦ã‚¹ã®å·¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ç·‘è‰²ã®ç·šã‚’æãã€å³ãƒœã‚¿ãƒ³ã§ç™½è‰²ã®ç·šã‚’æãã¾ã™ã€‚ä¸­å¤®ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ç”»é¢ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

```arduino
#include <M5Stack.h>
#include <SPI.h>
#include <Usb.h>
#include <hiduniversal.h>
#include <hidboot.h>
#include <usbhub.h>
#include "M5Mouse.h"

// new objects
USB Usb;
USBHub  Hub(&Usb);
HIDBoot<USB_HID_PROTOCOL_MOUSE> HidMouse(&Usb);
MouseRptParser  Prs;

// åˆæœŸåŒ–
M5.begin();
Usb.Init();
HidMouse.SetReportParser(0,(HIDReportParser*)&Prs);

// handle event coming from usb device
Usb.Task();
if(Usb.getUsbTaskState() == USB_STATE_RUNNING)
{
  Mouse_Pointer(mou_px, mou_py);
  mou_px = 0;
  mou_py = 0;
  /* left button pressed: draw white point */
  if (mou_button == 1)
    M5.Lcd.drawCircle(StaPotX, StaPotY, 1, WHITE);
  /* right button pressed: draw green point */
  if (mou_button == 2)
    M5.Lcd.drawCircle(StaPotX, StaPotY, 1, GREEN);
  /* middle button pressed: clear screen */
  if (mou_button == 4)
    M5.Lcd.fillScreen(BLACK);
}
```

<img src="assets/img/product_pics/module/module_example/USB/example_module_usb_01.png">

## å›è·¯å›³

<img src="assets/img/product_pics/module/usb_sch.png">

## é–¢é€£å‹•ç”»

**USB ãƒ‡ãƒ¢ - USBãƒ‡ãƒã‚¤ã‚’èª­ã¿è¾¼ã‚€**

<video width="500" controls>
    <source src="https://m5stack.oss-cn-shenzhen.aliyuncs.com/video/Blog/Twitch201902/USB%20Interface.mp4" type="video/mp4">
</video>
