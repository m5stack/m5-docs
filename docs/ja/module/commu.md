# COMMU ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« {docsify-ignore-all}

<img src="assets/img/product_pics/module/module_commu_01.png" width="30%" height="30%"> <img src="assets/img/product_pics/module/module_commu_02.png" width="30%" height="30%">

***

:memo:**[æ¦‚è¦](#æ¦‚è¦)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:octocat:**[ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](#ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:electric_plug:**[å›è·¯å›³](#å›è·¯å›³)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ›’**[è³¼å…¥ãƒªãƒ³ã‚¯](https://www.aliexpress.com/store/product/M5Stack-New-COMMU-Module-Extend-RS485-TTL-CAN-I2C-Port-with-MCP2515-TJA1051-SP3485-Development-Board/3226069_32954475633.html)**

## æ¦‚è¦

**<mark>COMMU</mark>**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆã®å¤§éƒ¨åˆ†ã‚’æº€ãŸã™äº‹ãŒã§ãã‚‹é€šä¿¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚1ã¤ã®RS-485ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€ï¼‘ã¤ã®CANã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€2ã¤ã®I2Cã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚M5Coreã«ã‚¹ã‚¿ãƒƒã‚¯ã™ã‚‹ã ã‘ã§ã€RS-485ãƒ‡ãƒã‚¤ã‚¹ã‚„CANãƒ‡ãƒã‚¤ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚TTLã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯UARTã§ã™ãŒã€(J6, J7, J9, J10)ã®ã‚¸ãƒ£ãƒ³ãƒ‘ã‚’å¤‰æ›´ã™ã‚‹äº‹ã§UART2ã«æ¥ç¶šå¯èƒ½ã§ã™ã€‚

## ç‰¹å¾´

- 2x I2C ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
- 1x CAN ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹(ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©: MCP2515, ãƒˆãƒ©ãƒ³ã‚·ãƒ¼ãƒ: TJA1051)
- 1x RS-485 ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹(SP3485)
- 1x TTL ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å®¹

- 1x COMMU ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

## ãƒ”ãƒ³ãƒãƒƒãƒ—

| CAN | ESP32 |
|:---:|:-----:|
| CAN_CS   | GPIO12 |
| CAN_INT  | GPIO15 |
| CAN_SCK  | GPIO18 |
| CAN_MISO | GPIO19 |
| CAN_MOSI | GPIO23 |

| I2C Interface | ESP32 |
|:-------------:|:-----:|
| IIC_SDA | GPIO21 |
| IIC_SCL | GPIO22 |

## é–¢é€£ãƒªãƒ³ã‚¯

- **[å…¬å¼ãƒ“ãƒ‡ã‚ª](https://www.youtube.com/channel/UCozgFVglWYQXbvTmGyS739w)**

- **[ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ](http://forum.m5stack.com/)**

- **[ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ](https://www.u-blox.com/zh/product/neo-m8-series)** (GPS)

- **ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ** - [MCP2515](http://ww1.microchip.com/downloads/en/devicedoc/20001801h.pdf) - [TJA1051](https://www.nxp.com/docs/en/data-sheet/TJA1051.pdf) - [SP3485](https://www.exar.com/ds/sp3485.pdf)

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

### Arduino IDE

#### CANé€šä¿¡

COMMUã§CANé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

[MCP_CAN_lib file](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/DependentLibrary/MCP_CAN_lib)ã‚’`C:\Users\<user_name>\Documents\Arduino\libraries`é…ä¸‹ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ãã—ã¦`commu_can_transmitter.ino`ã¨`commu_can_receiver.ino`ã‚’2ã¤ã®M5Coreã«ãã‚Œãã‚Œæ›¸ãè¾¼ã¿ã¾ã™ã€‚

*å®Œå…¨ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/CAN)*

```arduino
/*
    commu_can_transmitter.ino
*/
#include <M5Stack.h>
#include <mcp_can.h>
#include "m5_logo.h"

#define CAN0_INT 15 // Set INT to pin 2
MCP_CAN CAN0(12);   // Set CS to pin 10

// å®£è¨€
byte data[8] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};

// åˆæœŸåŒ–
M5.begin();
CAN0.begin(MCP_ANY, CAN_1000KBPS, MCP_8MHZ);
/* Change to normal mode to allow messages tobe transmitted */
CAN0.setMode(MCP_NORMAL);

// ãƒ‡ãƒ¼ã‚¿é€ä¿¡
CAN0.sendMsgBuf(0x100, 0, 8, data);
```

```arduino
/*
    commu_can_receiver.ino
*/
#include <M5Stack.h>
#include <mcp_can.h>
#include "m5_logo.h"

#define CAN0_INT 15 // Set INT to pin 2
MCP_CAN CAN0(12);   // Set CS to pin 10

// å®£è¨€
byte data[8] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};

// åˆæœŸåŒ–
M5.begin();
/* Initialize MCP2515 running at 16MHz with a baudrate of 500kb/s */
/* and the masks and filters disabled. */
CAN0.begin(MCP_ANY, CAN_1000KBPS, MCP_8MHZ);
/* Set operation mode to normal so theMCP2515 sends acks to received data. */
CAN0.setMode(MCP_NORMAL);
pinMode(CAN0_INT, INPUT);// Configuring pin for /INT input

// å—ä¿¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
CAN0.readMsgBuf(&rxId, &len, rxBuf);
```

<img src="assets/img/product_pics/module/module_example/COMMU/example_module_commu_01.png" width="50%" height="50%">

#### RS485é€šä¿¡

COMMUã§RS485é€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

[example](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/RS485)ã‚’ ï¼’ã¤ã®M5Coreã«ãã‚Œãã‚Œæ›¸ãè¾¼ã¿ã¾ã™ã€‚ãã—ã¦Aãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãƒ‡ãƒ¼ã‚¿ã®é€å—ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

<img src="assets/img/product_pics/module/module_example/COMMU/example_module_commu_02.png" width="50%" height="50%">

# å›è·¯å›³

<img src="assets/img/product_pics/module/commu_sch.png">
