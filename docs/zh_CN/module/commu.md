# COMMU - é€šä¿¡æ¨¡å—

<img src="assets/img/product_pics/module/module_commu_01.png" width="30%" height="30%"> <img src="assets/img/product_pics/module/module_commu_02.png" width="30%" height="30%">

***

<!-- :memo:**[æè¿°](#æè¿°)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:octocat:**[ä¾‹ç¨‹](#ä¾‹ç¨‹)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ›’**[è´­ä¹°é“¾æ¥](https://item.taobao.com/item.htm?spm=a1z10.5-c.w4002-1172588093.64.6c2275f4nUJEfh&id=580999880340)** -->

:memo:**[æè¿°](#æè¿°)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:octocat:**[ä¾‹ç¨‹](#ä¾‹ç¨‹)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:electric_plug:**[åŸç†å›¾](#åŸç†å›¾)**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ›’**[è´­ä¹°é“¾æ¥](https://item.taobao.com/item.htm?spm=a1z10.5-c.w4002-1172588093.64.6c2275f4nUJEfh&id=580999880340)**

## æè¿°

<mark>COMMU</mark>æ˜¯ä¸€ä¸ªé€šè®¯æ¥å£è½¬æ¢æ¨¡å—ï¼Œèƒ½å°†M5Coreçš„IOå£è½¬æ¢å¹¶å¤–æ‹“æˆå…¶ä»–ç±»å‹çš„æ¥å£ï¼Œæ»¡è¶³å¤šç§äº§å“è®¾è®¡éœ€æ±‚ã€‚ç›®å‰æ¨¡å—å¤–æ‹“2ä¸ªI2Cæ¥å£ï¼ŒMCUçš„TTLç”µå¹³å·²ç»è½¬æ¢æˆä¸€ä¸ªCANæ¥å£å’Œä¸€ä¸ªRS485æ¥å£ï¼ŒåŒæ—¶ä¹Ÿé™„å¸¦ä¸€ä¸ªç›´æ¥å¤–æ‹“çš„TTLç”µå¹³æ¥å£ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ è®¾è®¡äº§å“éœ€è¦ç”¨åˆ°CANé€šè®¯æˆ–RS485é€šè®¯çš„è®¾å¤‡æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ¨¡å—ï¼Œå †å ä¸M5Coreä¸»æ§æ¿ï¼Œå³å¯é©±åŠ¨å¯¹åº”è®¾å¤‡ï¼Œæ— éœ€å¦å¤–è®¢åšæ¥å£è½¬æ¢ç”µè·¯æ¿ã€‚

COMMUæ¨¡å—ä¸­çš„TTLæ¥å£ï¼Œå®é™…ä¸Šæ˜¯ä¸²å£æ¥å£ï¼Œé»˜è®¤è¿æ¥çš„æ˜¯ä¸²å£0ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡ç„Šæ¥è·³è½¬æ¥å£ï¼Œå¯ä»¥è·³è½¬æˆè¿æ¥ä¸²å£2ã€‚è·³çº¿æ¥å£Jumperæ˜¯J6, J7, J9, J10ã€‚

## ç‰¹æ€§

-  æ‹“å±•2ä¸ª I2C æ¥å£, 1ä¸ª CAN æ¥å£, 1ä¸ª RS485 æ¥å£, 1ä¸ª TTL æ¥å£

## åŒ…å«

-  1x M5Stack COMMU Module

## ç®¡è„šåˆ†é…

| *CAN*        | *ESP32 Chip*      |
| :----------: |:------------: |
| CAN_CS       | GPIO12         |
| CAN_INT      | GPIO15         |
| CAN_SCK      | GPIO18         |
| CAN_MISO     | GPIO19         |
| CAN_MOSI     | GPIO23         |


| *I2C Interface*   | *ESP32 Chip*      |
| :--------------:  |:------------: |
| IIC_SDA           | GPIO21         |
| IIC_SCL           | GPIO22         |

## ç›¸å…³é“¾æ¥

- **[å®˜æ–¹é¢‘é“è§†é¢‘](https://i.youku.com/i/UNjE1ODA2MzE0OA==?spm=a2hzp.8253869.0.0)**

- **[å®˜æ–¹è®ºå›](http://forum.m5stack.com/)**

## ä¾‹ç¨‹

### Arduino IDE

#### CANé€šä¿¡

è¿™æ˜¯ä¸¤ä¸ªCOMMUæ¨¡å—åˆ†åˆ«å †å äº†M5Coreä¹‹åï¼Œç›¸äº’ä¹‹é—´æ”¶å‘æ•°æ®çš„ä¾‹ç¨‹ã€‚

å…ˆå°†åº“[MCP_CAN_lib](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/DependentLibrary/MCP_CAN_lib)æ”¾ç½®åˆ°Arduinoçš„åº“ç®¡ç†æ–‡ä»¶è·¯å¾„`C:\Users\<user_name>\Documents\Arduino\libraries`ä¸­ï¼Œç„¶ååˆ†åˆ«æ‰“å¼€CANçš„å‘é€å’Œæ¥æ”¶ä¸¤ä¸ªç¨‹åºï¼Œå¹¶åˆ†åˆ«çƒ§å½•åˆ°ä¸¤ä¸ªm5coreä¸­ã€‚

*å…·ä½“ä¾‹ç¨‹è¯·ç‚¹å‡»[è¿™é‡Œ](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/CAN).*

```arduino
/*
    commu_can_transmitter.ino
*/
#include <M5Stack.h>
#include <mcp_can.h>
#include "m5_logo.h"

#define CAN0_INT 15 // Set INT to pin 2
MCP_CAN CAN0(12);   // Set CS to pin 10

// declaration
byte data[8] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};

// initialization
M5.begin();
CAN0.begin(MCP_ANY, CAN_1000KBPS, MCP_8MHZ);
/* Change to normal mode to allow messages tobe transmitted */
CAN0.setMode(MCP_NORMAL);

// send data
CAN0.sendMsgBuf(0x100, 0, 8, data);
```

```arduino
/*
    commu_can_receiver.ino
*/
#include <M5Stack.h>
#include <mcp_can.h>
#include "m5_logo.h"

#define CAN0_INT 15 // Set INT to pin 2
MCP_CAN CAN0(12);   // Set CS to pin 10

// declaration
byte data[8] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07};

// initialization
M5.begin();
/* Initialize MCP2515 running at 16MHz with a baudrate of 500kb/s */
/* and the masks and filters disabled. */
CAN0.begin(MCP_ANY, CAN_1000KBPS, MCP_8MHZ);
/* Set operation mode to normal so theMCP2515 sends acks to received data. */
CAN0.setMode(MCP_NORMAL);
pinMode(CAN0_INT, INPUT);// Configuring pin for /INT input

// read data
CAN0.readMsgBuf(&rxId, &len, rxBuf);
```

<img src="assets/img/product_pics/module/module_example/COMMU/example_module_commu_01.png" width="50%" height="50%">

#### RS485é€šä¿¡

è¿™æ˜¯ä¸¤ä¸ªM5Coreä¹‹é—´é€šè¿‡RS485ç›¸äº’æ”¶å‘æ•°æ®çš„ä¾‹ç¨‹ã€‚

åˆ†åˆ«ä¸‹è½½[ä¾‹ç¨‹](https://github.com/m5stack/M5-ProductExampleCodes/tree/master/Module/COMMU/Arduino/RS485)åˆ°ä¸¤ä¸ªM5Coreä¹‹åï¼ŒæŒ‰ä¸‹æŒ‰é”®Aï¼Œç„¶åä¸¤ä¸ªcoreä¹‹é—´ä¼šç›¸äº’å‘é€æ•°æ®ã€‚

<img src="assets/img/product_pics/module/module_example/COMMU/example_module_commu_02.png" width="50%" height="50%">

# åŸç†å›¾

<img src="assets/img/product_pics/module/commu_sch.png">